
to build the hex:

make mega2560

To flash the firmware, use avrdude version 5.11 or above

WARNING: following commands will erase EEPROM and FLASH contents. Backup your settings.

SERIAL_PORT=/dev/tty.usbserial
PROGRAMMER_TYPE=stk500v2

# optionally backup eeprom contents
avrdude -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT -U eeprom:r:eeprom.bin:r

# erase the chip (necessary before unlocking can happen), then unlock the boot loader area
# FIXME: not sure that clearing lock bits is actually required. Not a problem anyway.
avrdude -e -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT -U lock:w:0x3f:m

# flash the hex file (whatever.hex)
avrdude -v -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT  -U flash:w:stk500boot_v2_mega2560.hex

# set fuse bits for 2k bootloader (0xdc for 2k, 0xd8 for 8k)
avrdude -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT -U hfuse:w:0xdc:m

# re-lock the bootloader area of the chip
avrdude -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT -U lock:w:0x0f:m

# optionally restore eeprom contents
avrdude -c $PROGRAMMER_TYPE -p m2560 -P $SERIAL_PORT -U eeprom:w:eeprom.bin:r
